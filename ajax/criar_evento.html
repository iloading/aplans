<script>
    function mostrarCriarEvento() {
        
    
        $.ajax({
        // ajax call starts
        url: "scripts/sc_criar_evento_display.php",
        dataType: "json", // Choosing a JSON datatype

        }).done(function (data) {
            console.log(data);
            $("#conteudoPagina").html(""); //limpar o conteudo da pagina

            var cardTipoEvento = '';



            for (let i = 0; i < data.tipoEvento.length; i++) {


                cardTipoEvento+= '<div id="' + data.tipoEvento[i]["id"] +'" class="d-flex align-items-center position-relative selectTipoEvento" style="border-bottom: 1px solid #E1E2E3"> <div class="botao-circular m-0 p-0 position-absolute" style="left:10%;"><img src="images' + data.tipoEvento[i]["url"] +'" class="w-50";"></div> <div class="ml-5"> <p class="m-0 " style="font-size: 1rem">' + data.tipoEvento[i]["nome"] +'</p> </div> </div>';


            }

    




            /*Interface de Criar Evento*/

            var criarEvento = '<main class="position-relative text-black bg-white d-flex flex-column align-items-start topRedondo"> <div class="w-100 d-flex flex-column"> <div class="d-flex" style="width: inherit; background-color: #F1F3F6; z-index:2" id="navCompleta"> <article class="container d-flex flex-column pl-3 pr-3 pt-4 pb-4" style="max-width:inherit; background-color: #3C5E77;" id="nav"> <div class="align-items-center"> <div class="d-flex align-items-center pr-3"> <img style="width: 1.1rem; height:1.1rem" src="images/others/back (5).png"> </div> <div class="d-flex justify-content-center" id="imagem"> <div class="text-center"> <div class="img_tipo_evento menu_tipo_evento" style="position:relative;"><img  id="tipoEventoImg" class="dropbtn" src="images/others/click.png" style="width: 40%;"> <div id="dropdown_tipo" class="dropdown-content"> '+cardTipoEvento+' </div> <div class="text_alterarTipo">Alterar tipo de evento</div> </div> </div> </div> <div class="d-flex flex-column align-items-center mt-2"> <div class="mb-2 mt-2" style="width: 100%;"> <span class="textareaEventoNome" role="textbox" contenteditable></span> </div> <div id="data_evento" style="position:relative;"> <input id="dataEvento" type="datetime-local" style="background:none;color:white;border:none;font-size:0.9rem;"> </div> </div> </div> </article> </div> <div class="w-100 pt-3" id="margem_conteudo"> <div class="container-fluid"> <h2 class="font-weight-bold mb-3">Dados do Evento</h2> <div class="mb-4"> <h5 class="font-weight-bold">Local</h5> <span class="textareaLocal" role="textbox" contenteditable></span> </div> <div class="mb-4"> <h5 class="font-weight-bold pt-2">Descrição</h5> <span class="textareaDescricao" role="textbox" contenteditable></span> </div> <div class="mb-4"> <h5 class="font-weight-bold pt-2">Nº máximo participantes</h5> <div class="container-fluid pt-2 pl-0"> <input class="nParticipantes" id="participantes" type="number" value="0" min="2" max="250"></input> </div> </div> <div class="mb-4"> <h5 class="font-weight-bold">Adicionar tarefa</h5> <div class="d-flex"> <div class="position-relative" style="width: 70%;"> <span class="textareaTarefasNome mb-3" role="textbox" contenteditable></span> <span class="textareaTarefasDescricao mb-3" role="textbox" contenteditable></span> <div class="d-flex"> <p class="mr-4">Cor da tarefa :</p> <input id="corTarefa" type="color"> </div> </div> <div style="width:30%;display:flex;"> <div id="adicionarTarefa" class="botao-circular">+</div> </div> </div> <div id="tarefasAdicionadas"></div> </div> <div class="tarefas_restantes_div"></div> </div> </div> </div> <div class="position-relative w-100 d-flex botao_criar_evento_align justify-content-center pb-4 pt-4"> <button class="pl-3 pr-3 pt-1 pb-1 botaoCriarEvento">Criar Evento</button> </div> <input id="selectTipo" class="d-none" type="number"></main>'

            $("#conteudoPagina").append(criarEvento);

            $(document).ready(function(){

                $(".selectTipoEvento").click(function () {
                    var selecionarEvento = $(this).attr('id');
                    $('#selectTipo').val(selecionarEvento);
                    var imgUrl = $(this).find("img").attr("src");
                    $('#tipoEventoImg').attr("src",imgUrl);
                })

                /*Adcionar tarefas apenas à páginas de HTML */
                var num_tarefas = 0;

                $("#adicionarTarefa").click(function () {

                    num_tarefas ++
                    

                    var nomeTarefaEvento = $(".textareaTarefasNome").html();
                    var descricaoTarefaEvento = $(".textareaTarefasDescricao").html();
                    var corTarefa = $("#corTarefa").val();

                    var novaTarefa = '<div id="Tarefa'+num_tarefas+'" class="Tarefa pt-4 mt-3 d-flex"> <div style="width: 10%;"></div> <div style="width: 60%;"> <div class="pl-3 d-flex align-items-center" style="border-left: 3px solid '+corTarefa+'"> <p class="settingsTituloTab m-0" style="color:'+corTarefa+'">'+nomeTarefaEvento+'</p> </div> <div class="pl-3 pt-1 d-flex align-items-center" style="border-left: 3px solid '+corTarefa+'"> <p class="settingsDescTab m-0" style="font-size: 1rem">'+descricaoTarefaEvento+'</p> </div> </div> <div class="d-flex align-items-center justify-content-center eliminarTarefa" style="width: 30%;"> <img style="width: 20%;" src="images/settings/minus.png"> </div> </div>'

                    $('#tarefasAdicionadas').append(novaTarefa);
                  
                })
                /*Eliminar cada tarefa individualemnte */
                $(document).on('click', '.eliminarTarefa', function () {

                    $(this).parents('.Tarefa').remove();
                    num_tarefas--
                 })


               
                alturaConteudo()
                $('#participantes').niceNumber();

                $(window).on('resize', function(){
                    location.reload();
                })


                /* Quando o utilizador clica no seu avatar tipo eventos */
                function menu_tipo_evento() {
                    $("#dropdown_tipo").toggleClass("show");
                }

                
                $(".dropbtn").click(function () {
                    menu_tipo_evento();
                })

                $(".menu-tipo-evento").click(function () {
                    menu_tipo_evento();
                })


                // O dropdown fecha se o utilizador clicar fora dele 
                window.onclick = function (event) {
                    if (!event.target.matches('.dropbtn')) {
                        var dropdowns = document.getElementsByClassName("dropdown-content");
                        var i;
                        for (i = 0; i < dropdowns.length; i++) {
                            var openDropdown = dropdowns[i];
                            if (openDropdown.classList.contains('show')) {
                                openDropdown.classList.remove('show');
                            }
                        }
                    }
                }


                //Quando se clica no botao de criar evento faz um pedido de ajax
                  $(".botaoCriarEvento").click(function () {
                        
                        var nomeEvento = $(".textareaEventoNome").html();
                        var idTipoEvento =$("#selectTipo").val();
                        var dataEvento = $("#dataEvento").val();
                        var localEvento = $(".textareaLocal").html();
                        var descricaoEvento = $(".textareaDescricao").html();
                        var participantesEvento = $("#participantes").val();
                        var query_de_tarefas = "";  

                        
                        /*Verificação Nome*/
                        if (nomeEvento== "") {
                            $('.textareaEventoNome').addClass("outline");
                        }else{
                            $('.textareaEventoNome').removeClass("outline");
                        }

                        /*Verificação Tipo Evento*/
                        if (idTipoEvento == "") {
                            $('.img_tipo_evento ').addClass("outline");
                        }else{
                            $('.img_tipo_evento ').removeClass("outline");
                        }
                        /*Verificação data*/
                        if (dataEvento == "") {
                            $('#data_evento ').addClass("outline");
                        }else{
                            $('#data_evento ').removeClass("outline");
                        }

                        /*Verificação local*/
                        if (localEvento== "") {
                            $('.textareaLocal').addClass("outline");
                        }else{
                            $('.textareaLocal').removeClass("outline");
                        }

                        /*Verificação local*/
                        if (descricaoEvento== "") {
                            $('.textareaDescricao ').addClass("outline");
                        }else{
                            $('.textareaDescricao ').removeClass("outline");
                        }

                        /*Verificação num participantes*/
                        if (participantesEvento== "" || participantesEvento<2 || participantesEvento>250 ) {
                            $('.nice-number ').addClass("outline");
                        }else{
                            $('.nice-number ').removeClass("outline");
                        }



                        /*Se não houver tarefas, o ciclo for nem corre e, assim, não existem erros*/
                        for (let m = 1; m <= num_tarefas; m++) {
                            
                            var nomeTarefa = $("#Tarefa"+m).find('.settingsTituloTab').html();
                            var descTarefa = $("#Tarefa"+m).find('.settingsDescTab').html();
                            var corTarefa = $("#Tarefa"+m).find('.settingsTituloTab').css("color");
                        
                            query_de_tarefas += "&tarefa"+m+"nome="+nomeTarefa+"&tarefa"+m+"descricao="+descTarefa+"&tarefa"+m+"cor="+corTarefa;
                        }
                        

                        var nomeTarefaEvento = $(".textareaTarefasNome").html();
                        var eventoQuery = "nomeEvento=" + nomeEvento + "&idTipoEvento=" +idTipoEvento + "&dataEvento=" + dataEvento +"&localEvento=" + localEvento +"&descricaoEvento=" + descricaoEvento + "&participantesEvento=" + participantesEvento + query_de_tarefas + "&numTarefas=" + num_tarefas;

                        
                        
                        $.ajax({
                          // ajax call starts
                          url: "scripts/sc_criar_evento.php",
                          dataType: "json", // Choosing a JSON datatype
                          type: "GET",
                          data: eventoQuery,


                      }).done(function (data) {
                            window.location.href = "index.php";
                      })
                      
                })
               
            })
        

        });
    }

     

    
</script>

